<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>extjs练习</title>
    <link rel="stylesheet" href="classic/theme-neptune/resources/theme-neptune-all.css">
    <script type="text/javascript" src="ext-all-debug.js"></script>
    <script type="text/javascript" src="classic/theme-neptune/theme-neptune.js"></script>
</head>

<body>
    <script type="text/javascript">
    //官网例子，打开报错 (请注意has model和belong to不能同时使用)
    Ext.define("User", {
        extend: 'Ext.data.Model',
        fields: [
            'id', 'name'
        ],

        hasMany: {
            model: 'Order',
            name: 'orders'
        },

        proxy: {
            type: 'rest',
            url: 'json/users.json',
            reader: {
                type: 'json',
                rootProperty: 'users'
            }
        }
    });

    Ext.define("Order", {
        extend: 'Ext.data.Model',
        fields: [
            'id', 'total'
        ],

        hasMany: {
            model: 'OrderItem',
            name: 'orderItems',
            associationKey: 'order_items'
        }

    });

    Ext.define("OrderItem", {
        extend: 'Ext.data.Model',
        fields: [
            'id', 'price', 'quantity', 'order_id', 'product_id'
        ]
    });

    Ext.define("Product", {
        extend: 'Ext.data.Model',
        fields: [
            'id', 'name'
        ],

        hasMany: 'OrderItem'
    });

    var store = Ext.create('Ext.data.Store', {
        model: "User"
    });

    store.load({
        callback: function() {
            //the user that was loaded
            var user = store.getAt(0);

            console.log("Orders for " + user.get('name') + ":");
            
            user.orders().each(function(order) {
                console.log("Order ID: " + order.getId() + ", which contains items:");

                order.orderItems().each(function(orderItem) {

                    var product = orderItem.getProduct();

                    console.log(orderItem.get('quantity') + ' orders of ' + product.get('name'));
                });
            });
        }
    });
    </script>
</body>

</html>
